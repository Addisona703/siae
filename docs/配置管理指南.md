# SIAE é…ç½®ç®¡ç†æŒ‡å—

## ğŸ“‹ ç›®å½•

- [é…ç½®æ–‡ä»¶ç»“æ„](#é…ç½®æ–‡ä»¶ç»“æ„)
- [é…ç½®åŠ è½½é¡ºåº](#é…ç½®åŠ è½½é¡ºåº)
- [é…ç½®ä¼˜å…ˆçº§](#é…ç½®ä¼˜å…ˆçº§)
- [Nacos é…ç½®è§„åˆ™](#nacos-é…ç½®è§„åˆ™)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## é…ç½®æ–‡ä»¶ç»“æ„

### æ ‡å‡†é…ç½®æ–‡ä»¶

æ¯ä¸ªæœåŠ¡çš„é…ç½®æ–‡ä»¶ç»“æ„ï¼š

```
æœåŠ¡å/src/main/resources/
â”œâ”€â”€ bootstrap.yaml          # å¯åŠ¨é…ç½®ï¼ˆæœ€å…ˆåŠ è½½ï¼‰
â”œâ”€â”€ application-dev.yaml    # å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆæœ¬åœ°å¼€å‘ï¼‰
â””â”€â”€ application-nacos.yaml  # Nacos æ¨¡å¼é…ç½®ï¼ˆå›¢é˜Ÿåä½œï¼‰
```

### é…ç½®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ä½œç”¨ | ä½•æ—¶ä½¿ç”¨ |
|------|------|---------|
| `bootstrap.yaml` | å¯åŠ¨é…ç½®ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç¯å¢ƒ | å¿…éœ€ |
| `application-dev.yaml` | æœ¬åœ°å®Œæ•´é…ç½®ï¼Œä¸ä¾èµ– Nacos | æœ¬åœ°å¼€å‘ |
| `application-nacos.yaml` | Nacos æ¨¡å¼é…ç½®ï¼Œä» Nacos è¯»å– | å›¢é˜Ÿåä½œ |

---

## é…ç½®åŠ è½½é¡ºåº

### åœºæ™¯1ï¼šæœ¬åœ°æ¨¡å¼ (`active: dev`)

```
1. bootstrap.yaml
   â†“
2. Nacos é…ç½®ï¼ˆä¼šå°è¯•åŠ è½½ï¼Œä½†è¢«æœ¬åœ°é…ç½®è¦†ç›–ï¼‰
   â”œâ”€ siae-æœåŠ¡å.yaml
   â””â”€ siae-æœåŠ¡å-dev.yaml
   â†“
3. application-dev.yamlï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
   â†“
4. æœ€ç»ˆç”Ÿæ•ˆï¼šapplication-dev.yaml
```

### åœºæ™¯2ï¼šNacos æ¨¡å¼ (`active: nacos`)

```
1. bootstrap.yaml
   â†“
2. Nacos é…ç½®
   â”œâ”€ siae-æœåŠ¡å.yamlï¼ˆåŸºç¡€é…ç½®ï¼‰
   â””â”€ siae-æœåŠ¡å-nacos.yamlï¼ˆç¯å¢ƒé…ç½®ï¼Œå¯é€‰ï¼‰
   â†“
3. application-nacos.yamlï¼ˆæœ¬åœ°è¦†ç›–ï¼‰
   â†“
4. æœ€ç»ˆç”Ÿæ•ˆï¼šNacos é…ç½® + application-nacos.yaml è¦†ç›–
```

---

## é…ç½®ä¼˜å…ˆçº§

### ä¼˜å…ˆçº§æ’åºï¼ˆä»é«˜åˆ°ä½ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‘½ä»¤è¡Œå‚æ•°                        â”‚ â† æœ€é«˜ä¼˜å…ˆçº§
â”‚    java -jar app.jar --server.port=9090
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. ç¯å¢ƒå˜é‡                          â”‚
â”‚    export SERVER_PORT=9090
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. application-{profile}.yaml       â”‚ â† æœ¬åœ°é…ç½®æ–‡ä»¶
â”‚    (application-dev.yaml æˆ– application-nacos.yaml)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. Nacos è¿œç¨‹é…ç½®                    â”‚ â† Nacos é…ç½®ä¸­å¿ƒ
â”‚    (siae-æœåŠ¡å.yaml + siae-æœåŠ¡å-nacos.yaml)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. bootstrap.yaml                   â”‚ â† æœ€ä½ä¼˜å…ˆçº§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®è¦†ç›–ç¤ºä¾‹

å‡è®¾ï¼š
- **Nacos** é…ç½®ï¼š`server.port: 8020`
- **application-nacos.yaml** é…ç½®ï¼š`server.port: 9090`

**ç»“æœï¼šæœ€ç»ˆç”Ÿæ•ˆ `9090`**ï¼ˆæœ¬åœ°é…ç½®ä¼˜å…ˆçº§æ›´é«˜ï¼‰

---

## Nacos é…ç½®è§„åˆ™

### âš ï¸ é‡è¦ï¼šData ID å‘½åè§„åˆ™

**Spring Boot 3.x + `spring.config.import` æ–¹å¼ï¼š**

```yaml
# âŒ é”™è¯¯å†™æ³•ï¼ˆä¼šæ‰¾ .properties æ ¼å¼ï¼‰
spring:
  config:
    import: optional:nacos:siae-user

# âœ… æ­£ç¡®å†™æ³•ï¼ˆä¼šæ‰¾ .yaml æ ¼å¼ï¼‰
spring:
  config:
    import: optional:nacos:siae-user.yaml
                                    ^^^^^ 
                                    å¿…é¡»æŒ‡å®šæ‰©å±•å
```

### Nacos è‡ªåŠ¨åŠ è½½è§„åˆ™

**åªè¦é…ç½®äº† `spring.profiles.active`ï¼ŒNacos ä¼šè‡ªåŠ¨åŠ åç¼€ï¼š**

```yaml
spring:
  profiles:
    active: dev
  config:
    import: optional:nacos:siae-user.yaml
```

**å®é™…ä¼šå°è¯•åŠ è½½ï¼š**
```
1. siae-user.yaml           â† åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰
2. siae-user-dev.yaml       â† dev ç¯å¢ƒé…ç½®ï¼ˆä¼šè¦†ç›–åŸºç¡€é…ç½®ï¼‰
```

### Nacos Data ID å¯¹åº”å…³ç³»

| Profile | Data ID | è¯´æ˜ |
|---------|---------|------|
| `active: dev` | `siae-user.yaml` + `siae-user-dev.yaml` | æœ¬åœ°å¼€å‘ï¼ŒNacos é…ç½®ä¼šè¢«æœ¬åœ°è¦†ç›– |
| `active: nacos` | `siae-user.yaml` + `siae-user-nacos.yaml` | ä½¿ç”¨ Nacos é…ç½® |
| `active: prod` | `siae-user.yaml` + `siae-user-prod.yaml` | ç”Ÿäº§ç¯å¢ƒ |

---

## å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šä¸ºä»€ä¹ˆé…ç½®äº† Nacos ä½†ä¸ç”Ÿæ•ˆï¼Ÿ

**åŸå› ï¼š**
- `config.import` ä¸­æ²¡æœ‰æŒ‡å®š `.yaml` æ‰©å±•å
- Nacos é»˜è®¤æ‰¾ `.properties` æ ¼å¼
- ä½†ä½ åˆ›å»ºçš„æ˜¯ `.yaml` æ ¼å¼

**è§£å†³ï¼š**
```yaml
# ä¿®æ”¹ bootstrap.yaml
spring:
  config:
    import: optional:nacos:siae-user.yaml  # åŠ ä¸Š .yaml
```

---

### é—®é¢˜2ï¼šä¸ºä»€ä¹ˆ Nacos æ‰¾ä¸åˆ°é…ç½®ï¼Ÿ

**åŸå› ï¼š**
- Nacos ä¼šè‡ªåŠ¨åŠ ä¸Š `-${profile}` åç¼€
- ä¾‹å¦‚ `active: nacos` ä¼šæ‰¾ `siae-user-nacos.yaml`

**è§£å†³ï¼š**
åœ¨ Nacos ä¸­åˆ›å»ºå¯¹åº”çš„é…ç½®ï¼š
```
Data ID: siae-user.yamlï¼ˆå¿…éœ€ï¼ŒåŸºç¡€é…ç½®ï¼‰
Data ID: siae-user-nacos.yamlï¼ˆå¯é€‰ï¼Œç¯å¢ƒé…ç½®ï¼‰
Group: SIAE_GROUP
é…ç½®æ ¼å¼: YAML
```

---

### é—®é¢˜3ï¼šæœ¬åœ°æ¨¡å¼ä¸‹è¿˜ä¼šè¿æ¥ Nacos å—ï¼Ÿ

**ç­”æ¡ˆï¼šä¼šï¼**

å³ä½¿ `active: dev`ï¼ˆæœ¬åœ°å¼€å‘æ¨¡å¼ï¼‰ï¼ŒSpring Boot ä»ä¼šå°è¯•åŠ è½½ Nacos é…ç½®ï¼Œä½†ï¼š
- å› ä¸ºæœ‰ `optional:` å‰ç¼€ï¼Œæ‰¾ä¸åˆ°é…ç½®ä¸ä¼šæŠ¥é”™
- `application-dev.yaml` ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼šè¦†ç›– Nacos é…ç½®

**è¿™æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œä¸å½±å“ä½¿ç”¨ã€‚**

---

### é—®é¢˜4ï¼š`spring.cloud.nacos.config.file-extension` ä¸èµ·ä½œç”¨ï¼Ÿ

**åŸå› ï¼š**
- è¿™ä¸ªé…ç½®åªå¯¹æ—§ç‰ˆ Spring Cloud Alibaba æœ‰æ•ˆ
- Spring Boot 3.x ä½¿ç”¨ `spring.config.import` æ–¹å¼
- å¿…é¡»åœ¨ `config.import` ä¸­æ˜ç¡®æŒ‡å®šæ‰©å±•å

**è§£å†³ï¼š**
```yaml
# âŒ è¿™æ ·ä¸èµ·ä½œç”¨
spring:
  cloud:
    nacos:
      config:
        file-extension: yaml  # æ— æ•ˆ
  config:
    import: optional:nacos:siae-user

# âœ… æ­£ç¡®åšæ³•
spring:
  config:
    import: optional:nacos:siae-user.yaml  # ç›´æ¥æŒ‡å®š
```

---

## æœ€ä½³å®è·µ

### 1. bootstrap.yaml é…ç½®

```yaml
# ===================================================================
# BOOTSTRAP CONFIGURATION
# ===================================================================

spring:
  application:
    name: siae-æœåŠ¡å
  
  profiles:
    # åˆ‡æ¢ç¯å¢ƒï¼š
    # - dev: æœ¬åœ°å¼€å‘ï¼Œä¸ä¾èµ– Nacos
    # - nacos: ä½¿ç”¨ Nacos é…ç½®
    active: dev
  
  cloud:
    nacos:
      server-addr: localhost:8948
      config:
        group: SIAE_GROUP
  
  config:
    # âš ï¸ é‡è¦ï¼šå¿…é¡»åŠ  .yaml æ‰©å±•å
    import: optional:nacos:siae-æœåŠ¡å.yaml
```

---

### 2. application-dev.yaml é…ç½®

```yaml
# ===================================================================
# DEV CONFIGURATION (æœ¬åœ°å¼€å‘é…ç½®)
# ===================================================================

server:
  port: 8020
  servlet:
    context-path: /api/v1/æœåŠ¡å

spring:
  # æ•°æ®åº“é…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/db_name
    username: root
    password: 123456
  
  # Redis é…ç½®
  data:
    redis:
      host: localhost
      port: 6379
      password: 123456

# MyBatis Plus é…ç½®
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# æ—¥å¿—é…ç½®
logging:
  level:
    root: INFO
    com.hngy.siae: DEBUG

# å…¶ä»–ä¸šåŠ¡é…ç½®...
```

---

### 3. application-nacos.yaml é…ç½®

```yaml
# ===================================================================
# NACOS CONFIGURATION (ä½¿ç”¨ Nacos)
# ===================================================================

spring:
  cloud:
    nacos:
      discovery:
        enabled: true  # å¯ç”¨æœåŠ¡å‘ç°
      config:
        enabled: true  # å¯ç”¨é…ç½®ä¸­å¿ƒ

# æœ¬åœ°è¦†ç›–é…ç½®ï¼ˆå¯é€‰ï¼‰
# å¦‚æœéœ€è¦ä¸´æ—¶è¦†ç›– Nacos ä¸­çš„æŸäº›é…ç½®ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ 
logging:
  level:
    root: INFO
    com.hngy.siae: DEBUG
```

---

### 4. Nacos é…ç½®å†…å®¹

#### åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰

```
Data ID: siae-æœåŠ¡å.yaml
Group: SIAE_GROUP
é…ç½®æ ¼å¼: YAML

å†…å®¹ï¼š
server:
  port: 8020
  servlet:
    context-path: /api/v1/æœåŠ¡å

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/db_name
    username: root
    password: 123456
  
  data:
    redis:
      host: localhost
      port: 6379
      password: 123456

# å…¶ä»–ä¸šåŠ¡é…ç½®...
```

#### ç¯å¢ƒé…ç½®ï¼ˆnacos ç¯å¢ƒï¼Œå¯é€‰ï¼‰

```
Data ID: siae-æœåŠ¡å-nacos.yaml
Group: SIAE_GROUP
é…ç½®æ ¼å¼: YAML

å†…å®¹ï¼š
# Nacos ç¯å¢ƒç‰¹å®šé…ç½®ï¼ˆä¼šè¦†ç›–åŸºç¡€é…ç½®ï¼‰
# é€šå¸¸å¯ä»¥ä¸ºç©ºï¼Œæˆ–åªé…ç½®å°‘é‡ç¯å¢ƒå·®å¼‚
logging:
  level:
    root: DEBUG
```

---

### 5. é…ç½®ç­–ç•¥

#### Nacos ä¸­æ”¾ä»€ä¹ˆï¼Ÿ
- âœ… æ•°æ®åº“è¿æ¥é…ç½®
- âœ… Redis é…ç½®
- âœ… ç¬¬ä¸‰æ–¹æœåŠ¡é…ç½®
- âœ… ä¸šåŠ¡å‚æ•°é…ç½®
- âœ… å›¢é˜Ÿå…±äº«çš„é…ç½®

#### application-dev.yaml ä¸­æ”¾ä»€ä¹ˆï¼Ÿ
- âœ… æœ¬åœ°å¼€å‘çš„å®Œæ•´é…ç½®
- âœ… æ•°æ®åº“ã€Redis ç­‰æœ¬åœ°æœåŠ¡é…ç½®
- âœ… ä¸ä¾èµ– Nacos çš„ç‹¬ç«‹é…ç½®

#### application-nacos.yaml ä¸­æ”¾ä»€ä¹ˆï¼Ÿ
- âœ… Nacos è¿æ¥é…ç½®
- âœ… æœ¬åœ°éœ€è¦è¦†ç›–çš„é…ç½®ï¼ˆå¦‚æ—¥å¿—çº§åˆ«ï¼‰
- âœ… æœåŠ¡å‘ç°é…ç½®

#### bootstrap.yaml ä¸­æ”¾ä»€ä¹ˆï¼Ÿ
- âœ… åº”ç”¨åç§°
- âœ… ç¯å¢ƒé€‰æ‹©ï¼ˆactiveï¼‰
- âœ… Nacos æœåŠ¡å™¨åœ°å€

---

## ç¯å¢ƒåˆ‡æ¢

### æœ¬åœ°å¼€å‘ï¼ˆä¸ä½¿ç”¨ Nacosï¼‰

```yaml
# bootstrap.yaml
spring:
  profiles:
    active: dev
```

å¯åŠ¨åä½¿ç”¨ `application-dev.yaml` çš„é…ç½®ã€‚

---

### å›¢é˜Ÿåä½œï¼ˆä½¿ç”¨ Nacosï¼‰

```yaml
# bootstrap.yaml
spring:
  profiles:
    active: nacos
```

å¯åŠ¨åä» Nacos åŠ è½½é…ç½®ã€‚

---

## éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

### æŸ¥çœ‹å¯åŠ¨æ—¥å¿—

**ä½¿ç”¨ Nacos é…ç½®ï¼ˆæˆåŠŸï¼‰ï¼š**
```
INFO  - [Nacos Config] Load config[dataId=siae-user.yaml, group=SIAE_GROUP] success
INFO  - [Nacos Config] Load config[dataId=siae-user-nacos.yaml, group=SIAE_GROUP] success
```

**ä½¿ç”¨æœ¬åœ°é…ç½®ï¼š**
```
WARN  - Ignore the empty nacos configuration and get it based on 
        dataId[siae-user-dev.properties] & group[SIAE_GROUP]
```
ï¼ˆè¯´æ˜ Nacos é…ç½®æ²¡æ‰¾åˆ°ï¼Œä½¿ç”¨çš„æ˜¯æœ¬åœ°é…ç½®ï¼‰

---

### åŠ¨æ€åˆ·æ–°æµ‹è¯•

1. å¯åŠ¨æœåŠ¡
2. ä¿®æ”¹ Nacos ä¸­çš„é…ç½®ï¼ˆå¦‚æ—¥å¿—çº§åˆ«ï¼‰
3. è§‚å¯ŸæœåŠ¡æ˜¯å¦è‡ªåŠ¨åˆ·æ–°

- **å¦‚æœåˆ·æ–°äº†** â†’ ä½¿ç”¨çš„æ˜¯ Nacos é…ç½® âœ…
- **å¦‚æœæ²¡åˆ·æ–°** â†’ ä½¿ç”¨çš„æ˜¯æœ¬åœ°é…ç½® âŒ

---

## æ€»ç»“

### å…³é”®è¦ç‚¹

1. âš ï¸ **`config.import` å¿…é¡»æŒ‡å®š `.yaml` æ‰©å±•å**
2. âš ï¸ **Nacos ä¼šè‡ªåŠ¨åŠ ä¸Š `-${profile}` åç¼€**
3. âš ï¸ **æœ¬åœ°é…ç½®ä¼˜å…ˆçº§é«˜äº Nacos é…ç½®**
4. âœ… **ä½¿ç”¨ `optional:` å‰ç¼€é¿å… Nacos ä¸å¯ç”¨æ—¶æŠ¥é”™**
5. âœ… **æœ¬åœ°æ¨¡å¼å’Œ Nacos æ¨¡å¼å¯ä»¥è‡ªç”±åˆ‡æ¢**

### é…ç½®æ£€æŸ¥æ¸…å•

- [ ] `bootstrap.yaml` ä¸­ `config.import` æ˜¯å¦åŠ äº† `.yaml` æ‰©å±•å
- [ ] Nacos ä¸­æ˜¯å¦åˆ›å»ºäº†åŸºç¡€é…ç½®ï¼ˆå¦‚ `siae-user.yaml`ï¼‰
- [ ] Nacos é…ç½®æ ¼å¼æ˜¯å¦é€‰æ‹©äº† `YAML`
- [ ] `application-dev.yaml` å’Œ Nacos é…ç½®å†…å®¹æ˜¯å¦ä¸€è‡´
- [ ] å¯åŠ¨æ—¥å¿—æ˜¯å¦æ˜¾ç¤ºæˆåŠŸåŠ è½½ Nacos é…ç½®

---

## é™„å½•ï¼šå®Œæ•´é…ç½®ç¤ºä¾‹

### bootstrap.yaml

```yaml
spring:
  application:
    name: siae-user
  profiles:
    active: dev  # æœ¬åœ°å¼€å‘æ¨¡å¼
  cloud:
    nacos:
      server-addr: localhost:8948
      config:
        group: SIAE_GROUP
  config:
    import: optional:nacos:siae-user.yaml
```

### application-dev.yaml

```yaml
server:
  port: 8020
  servlet:
    context-path: /api/v1/user

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/user_db
    username: root
    password: 123456
  
  data:
    redis:
      host: localhost
      port: 6379
      password: 123456

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

logging:
  level:
    root: INFO
    com.hngy.siae: DEBUG
```

### application-nacos.yaml

```yaml
spring:
  cloud:
    nacos:
      discovery:
        enabled: true
      config:
        enabled: true

logging:
  level:
    root: INFO
    com.hngy.siae: DEBUG
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-13  
**ç»´æŠ¤è€…ï¼š** SIAE å¼€å‘å›¢é˜Ÿ
