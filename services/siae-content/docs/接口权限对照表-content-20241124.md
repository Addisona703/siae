# 接口权限对照表 - Content服务

生成日期：2024-11-24

## 权限常量说明

### 角色级别常量
- `RoleConstants.ANY_AUTHENTICATED` - 所有已认证用户
- `RoleConstants.MEMBER_LEVEL` - 成员级别（管理员或成员）
- `RoleConstants.ADMIN_LEVEL` - 管理员级别
- `RoleConstants.ROOT_LEVEL` - 超级管理员（默认放行所有接口）

### 权限码格式
- 格式：`模块:资源:操作`
- 示例：`content:publish`、`content:category:create`、`content:audit:handle`

---

## AuditsController - 审核管理

- PUT /audits/{id} - handleAudit
  权限：@SiaeAuthorize("hasAuthority('content:audit:handle')")
  描述：处理审核，包括审核通过、拒绝等操作

- POST /audits/page - getAuditPage
  权限：@SiaeAuthorize("hasAuthority('content:audit:view')")
  描述：分页获取审核列表，支持按目标类型和审核状态筛选

- POST /audits/record - getAuditRecord
  权限：@SiaeAuthorize("hasAuthority('content:audit:view')")
  描述：根据目标对象ID和类型获取审核记录详情

---

## CategoriesController - 分类管理

- POST /categories - createCategory
  权限：@SiaeAuthorize("hasAuthority('content:category:create')")
  描述：创建新的内容分类

- PUT /categories - updateCategory
  权限：@SiaeAuthorize("hasAuthority('content:category:edit')")
  描述：修改已存在的分类信息

- DELETE /categories/{categoryId} - deleteCategory
  权限：@SiaeAuthorize("hasAuthority('content:category:delete')")
  描述：删除指定的分类

- POST /categories/page - listCategories
  权限：@SiaeAuthorize("hasAuthority('content:category:view')")
  描述：获取分类的分页列表，支持关键词搜索和条件筛选

- GET /categories/detail/{categoryId} - queryCategory
  权限：@SiaeAuthorize("hasAuthority('content:category:view')")
  描述：根据分类ID获取分类的详细信息

- POST /categories/toggle-enable - updateStatus
  权限：@SiaeAuthorize("hasAuthority('content:category:toggle')")
  描述：切换分类的启用状态

---

## CommentsController - 评论管理

- POST /comments/{contentId} - createComment
  权限：无权限注解（所有认证用户可访问）
  描述：为指定内容创建评论

- PUT /comments/{commentId} - updateComment
  权限：无权限注解（所有认证用户可访问）
  描述：更新指定评论的内容

- DELETE /comments/{id} - deleteComment
  权限：无权限注解（所有认证用户可访问，非管理员只能删除自己创建的评论）
  描述：删除指定的评论

- POST /comments/{contentId}/page - listComments
  权限：无权限注解（所有认证用户可访问）
  描述：根据内容ID分页查询评论列表

- POST /comments/page - listCommentsPage
  权限：无权限注解（所有认证用户可访问）
  描述：使用标准化分页参数查询评论列表，支持多条件查询

---

## ContentController - 内容管理

- POST / - publishContent
  权限：@SiaeAuthorize("hasAuthority('content:publish')")
  描述：创建并发布新的内容，支持文章、笔记、提问、文件、视频等多种类型

- PUT / - editContent
  权限：@SiaeAuthorize("hasAuthority('content:edit')")
  描述：修改已存在的内容信息，包括标题、描述、分类等

- DELETE / - deleteContent
  权限：@SiaeAuthorize("hasAuthority('content:delete')")
  描述：删除指定的内容，可选择永久删除或移至垃圾箱（非管理员只能删除自己创建的内容）

- GET /query/{contentId} - queryContent
  权限：@SiaeAuthorize("hasAuthority('content:query')")
  描述：根据内容ID获取内容的详细信息

- POST /page - queryContentList
  权限：@SiaeAuthorize("hasAuthority('content:list:view')")
  描述：分页查询内容列表，支持按分类、标签、状态等条件筛选

- GET /hot - queryHotContent
  权限：无权限注解（公开接口）
  描述：查询热门内容列表

---

## FavoritesController - 收藏管理

### 收藏夹管理

- POST /favorites/folders - createFolder
  权限：@SiaeAuthorize("hasAuthority('content:favorite:manage')")
  描述：创建一个新的收藏夹

- PUT /favorites/folders - updateFolder
  权限：@SiaeAuthorize("hasAuthority('content:favorite:manage')")
  描述：更新收藏夹的名称、描述等信息（非管理员只能更新自己的）

- DELETE /favorites/folders/{folderId} - deleteFolder
  权限：@SiaeAuthorize("hasAuthority('content:favorite:manage')")
  描述：删除指定的收藏夹，默认收藏夹不可删除（非管理员只能删除自己的）

- GET /favorites/folders/user/{userId} - getUserFolders
  权限：@SiaeAuthorize("hasAuthority('content:favorite:view')")
  描述：获取指定用户的所有收藏夹

- GET /favorites/folders/{folderId} - getFolderDetail
  权限：@SiaeAuthorize("hasAuthority('content:favorite:view')")
  描述：获取指定收藏夹的详细信息

### 收藏内容管理

- POST /favorites/items - addFavorite
  权限：@SiaeAuthorize("hasAuthority('content:favorite:add')")
  描述：将内容添加到收藏夹

- PUT /favorites/items - updateFavorite
  权限：@SiaeAuthorize("hasAuthority('content:favorite:manage')")
  描述：更新收藏的备注、移动到其他收藏夹等（非管理员只能更新自己的）

- DELETE /favorites/items/{itemId} - removeFavorite
  权限：@SiaeAuthorize("hasAuthority('content:favorite:remove')")
  描述：从收藏夹中移除指定内容

- POST /favorites/items/folder/{folderId} - getFolderItems
  权限：@SiaeAuthorize("hasAuthority('content:favorite:view')")
  描述：分页查询指定收藏夹中的收藏内容

- POST /favorites/items/user/{userId} - getUserFavorites
  权限：@SiaeAuthorize("hasAuthority('content:favorite:view')")
  描述：分页查询用户在所有收藏夹中的收藏内容

- GET /favorites/items/check - checkFavorite
  权限：@SiaeAuthorize("hasAuthority('content:favorite:view')")
  描述：检查用户是否已收藏指定内容

---

## InteractionsController - 用户交互

- POST /interactions/action - recordAction
  权限：无权限注解（所有认证用户可访问）
  描述：记录用户对内容的交互行为，如点赞、收藏、浏览等

- DELETE /interactions/action - cancelAction
  权限：无权限注解（所有认证用户可访问）
  描述：取消用户对内容的交互行为，如取消点赞、取消收藏等

---

## StatisticsController - 统计管理

### 基础统计操作

- POST /statistics/{contentId} - createStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:create')")
  描述：为新创建的内容初始化统计记录

- GET /statistics/{contentId} - getStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:view')")
  描述：根据内容ID获取统计数据，包括浏览量、点赞数、收藏数、评论数等

- PUT /statistics/{contentId} - updateStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:update')")
  描述：更新指定内容的统计数据

- POST /statistics/{contentId}/increment - incrementStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:update')")
  描述：对指定内容的统计数据进行增量操作（浏览+1、点赞+1、收藏+1）

- POST /statistics/{contentId}/decrement - decrementStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:update')")
  描述：对指定内容的统计数据进行递减操作（点赞-1、收藏-1）

### 聚合统计接口（用于前端图表）

- GET /statistics/summary - getStatisticsSummary
  权限：@SiaeAuthorize("hasAuthority('content:statistics:view')")
  描述：获取全站统计汇总数据，包括总浏览量、总点赞数、总收藏数、总评论数、今日数据等

- GET /statistics/by-type - getContentTypeStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:view')")
  描述：统计各内容类型（文章、笔记、问答、文件、视频）的数量和互动数据

- GET /statistics/by-category - getCategoryStatistics
  权限：@SiaeAuthorize("hasAuthority('content:statistics:view')")
  描述：统计各分类的内容数量和互动数据

- GET /statistics/trend - getTrendData
  权限：@SiaeAuthorize("hasAuthority('content:statistics:view')")
  描述：获取指定天数内的统计趋势数据，用于折线图展示

---

## TagsController - 标签管理

- POST /tags - createTag
  权限：@SiaeAuthorize("hasAuthority('content:tag:create')")
  描述：创建新的内容标签

- PUT /tags/{id} - updateTag
  权限：@SiaeAuthorize("hasAuthority('content:tag:edit')")
  描述：修改已存在的标签信息

- DELETE /tags/{id} - deleteTag
  权限：@SiaeAuthorize("hasAuthority('content:tag:delete')")
  描述：删除指定的标签

- POST /tags/page - listTags
  权限：@SiaeAuthorize("hasAuthority('content:tag:view')")
  描述：获取标签的分页列表，支持关键词搜索和条件筛选

---

## 权限配置建议

### 需要添加权限注解的接口

以下接口当前没有权限注解，建议根据业务需求添加：

1. **CommentsController** - 评论管理
   - 建议所有接口添加 `RoleConstants.ANY_AUTHENTICATED`（所有认证用户）
   - 或使用具体权限：`content:comment:create`、`content:comment:edit`、`content:comment:delete`、`content:comment:view`

2. **InteractionsController** - 用户交互
   - 建议添加 `RoleConstants.ANY_AUTHENTICATED`（所有认证用户）
   - 或使用具体权限：`content:interaction:record`、`content:interaction:cancel`

3. **ContentController.queryHotContent**
   - 建议添加 `RoleConstants.ANY_AUTHENTICATED`（所有认证用户）
   - 或使用权限：`content:hot:view`

### 权限级别建议

**管理员级别权限（需要 ADMIN_LEVEL）：**
- 审核管理：`content:audit:handle`、`content:audit:view`
- 分类管理：`content:category:create`、`content:category:edit`、`content:category:delete`、`content:category:toggle`
- 标签管理：`content:tag:create`、`content:tag:edit`、`content:tag:delete`
- 统计管理：`content:statistics:create`、`content:statistics:update`

**成员级别权限（需要 MEMBER_LEVEL）：**
- 内容发布：`content:publish`
- 内容编辑：`content:edit`（仅限自己的内容）
- 内容删除：`content:delete`（仅限自己的内容）

**所有认证用户权限（ANY_AUTHENTICATED）：**
- 内容查询：`content:query`、`content:list:view`、`content:hot:view`
- 分类查询：`content:category:view`
- 标签查询：`content:tag:view`
- 评论操作：`content:comment:create`、`content:comment:edit`、`content:comment:delete`、`content:comment:view`
- 收藏操作：`content:favorite:add`、`content:favorite:manage`、`content:favorite:remove`、`content:favorite:view`
- 用户交互：`content:interaction:record`、`content:interaction:cancel`
- 统计查询：`content:statistics:view`

---

## 总结

**Content服务共扫描到：**
- 8个Controller
- 52个接口
- 其中3个接口无权限注解（建议补充）

**权限分布：**
- 审核管理：2个权限
- 分类管理：5个权限
- 标签管理：4个权限
- 内容管理：5个权限
- 评论管理：4个权限（预留）
- 收藏管理：4个权限
- 用户交互：2个权限（预留）
- 统计管理：3个权限
