# ===================================================================
# CENTRALIZED CONFIGURATION FOR SIAE-CONTENT (DEV)
# Managed entirely in Nacos
# ===================================================================

# 1. 服务端口 (为内容服务分配新端口，如8083)
server:
  port: 8010
  servlet:
    context-path: /api/v1/content

spring:
  # 2. 启用Nacos服务发现
  cloud:
    nacos:
      discovery:
        enabled: true
  # 4. 数据库连接配置 (假设内容服务的数据库名为 content_db)
  # 密码等敏感信息被安全地存放在Nacos中
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/content_db?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: 123456 # 生产环境请使用更强的密码
    hikari:
      maximum-pool-size: 10        # 最大连接数
      minimum-idle: 2              # 最小空闲连接数
      idle-timeout: 60000          # 连接最大空闲时间（ms）
      max-lifetime: 1800000        # 最大连接存活时间（ms）
      connection-timeout: 30000    # 获取连接超时（ms）
  # 5. Jackson JSON序列化配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    default-property-inclusion: non_null

# 6. MyBatis Plus 配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: auto
  # 路径修改为指向content模块的mapper和entity
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.hngy.siae.content.entity

# 7. SpringDoc API文档配置 (使用统一配置)
springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    enabled: true

# ===================================================================
# SIAE Starter 配置
# ===================================================================

# Web功能配置
siae:
  web:
    # 统一响应处理
    response:
      enabled: true
      base-packages: ["com.hngy.siae.content"]
      exclude-patterns: ["/actuator/**", "/swagger-ui/**", "/v3/api-docs/**"]
    # 全局异常处理
    exception:
      enabled: true
      print-stack-trace: true
      include-stack-trace: false
    # Jackson序列化
    jackson:
      enabled: true
      date-format: "yyyy-MM-dd HH:mm:ss"
      time-zone: "GMT+8"
    # MyBatis Plus
    mybatis-plus:
      enabled: true
      pagination-enabled: true
      max-limit: 1000
      logic-delete-enabled: true

  # 安全功能配置
  security:
    enabled: true
    # JWT配置
    jwt:
      enabled: true
      secret: "siae-content-secret-key-change-in-production"
      access-token-expiration: 7200  # 2小时
      refresh-token-expiration: 604800  # 7天
      token-prefix: "Bearer "
      header-name: "Authorization"
    # 权限配置
    permission:
      cache-enabled: true
      cache-expiration: 1800  # 30分钟
      redis-enabled: true
      fallback-enabled: true
      throw-exception-on-failure: false
      log-enabled: false
    # 需要权限验证的服务
    auth-required-services: ["siae-auth", "siae-user", "siae-content"]
    # 白名单路径
    whitelist-paths:
      - "/actuator/**"
      - "/swagger-ui/**"
      - "/v3/api-docs/**"
      - "/favicon.ico"
      - "/error"