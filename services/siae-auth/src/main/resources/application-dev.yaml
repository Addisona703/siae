# ===================================================================
# CENTRALIZED CONFIGURATION FOR SIAE-AUTH (DEV)
# Managed entirely in Nacos
# ===================================================================

# Server and Context Path
server:
  port: 8000
  servlet:
    context-path: /api/v1/auth

spring:
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  application:
    name: siae-auth
  # Enable Nacos service discovery for this service
  cloud:
    nacos:
      discovery:
        enabled: true
  # ❗ Database credentials - Now securely managed in Nacos
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/auth_db?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: root
    password: 123456 # Replace with your actual password

  # Redis Configuration for Permission Caching
  data:
    redis:
      host: localhost
      port: 6379
      password: # Set if Redis has password
      database: 0
      timeout: 5000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  # Jackson JSON Configuration
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    serialization:
      indent-output: true
      write-dates-as-timestamps: false
      fail-on-empty-beans: false
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null

# MyBatis Plus Configuration
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: auto
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.hngy.siae.auth.entity

# SpringDoc API Documentation (使用统一配置)
springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    enabled: true

# ===================================================================
# SIAE Starter 配置
# ===================================================================

# Web功能配置
siae:
  web:
    # 统一响应处理
    response:
      enabled: true
      base-packages: ["com.hngy.siae.auth"]
      exclude-patterns: ["/actuator/**", "/swagger-ui/**", "/v3/api-docs/**"]
    # 全局异常处理
    exception:
      enabled: true
      print-stack-trace: true
      include-stack-trace: false
    # Jackson序列化
    jackson:
      enabled: true
      date-format: "yyyy-MM-dd HH:mm:ss"
      time-zone: "GMT+8"
    # MyBatis Plus
    mybatis-plus:
      enabled: true
      pagination-enabled: true
      max-limit: 1000
      logic-delete-enabled: true

  # 安全功能配置
  security:
    enabled: true
    # JWT配置
    jwt:
      enabled: true
      secret: "siae-auth-secret-key-change-in-production"
      access-token-expiration: 7200  # 2小时
      refresh-token-expiration: 604800  # 7天
      token-prefix: "Bearer "
      header-name: "Authorization"
      allow-multiple-devices: true
    # 权限配置
    permission:
      cache-enabled: true
      cache-expiration: 1800  # 30分钟
      redis-enabled: true
      fallback-enabled: true
      throw-exception-on-failure: false
      log-enabled: false
    # 需要权限验证的服务
    auth-required-services: ["siae-auth", "siae-user", "siae-content"]
    # 白名单路径
    whitelist-paths:
      - "/login"
      - "/register"
      - "/logout"
      - "/refresh-token"
      - "/actuator/**"
      - "/swagger-ui/**"
      - "/v3/api-docs/**"
      - "/favicon.ico"
      - "/error"