# siae-user 服务接口权限对照表

> 生成日期：2024-11-24  
> 服务名称：siae-user  
> 说明：超级管理员（ROLE_ROOT）默认放行所有接口，无需在权限表达式中声明

---

## AwardLevelController - 奖项等级字典管理

**Base Path**: `/api/v1/users/award-levels`

- **POST** `/award-levels` - createAwardLevel  
  权限：`@SiaeAuthorize("hasAuthority('user:award-level:create')")`  
  描述：创建奖项等级

- **PUT** `/award-levels/{id}` - updateAwardLevel  
  权限：`@SiaeAuthorize("hasAuthority('user:award-level:update')")`  
  描述：更新奖项等级信息

- **GET** `/award-levels/{id}` - getAwardLevelById  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：根据ID获取奖项等级

- **GET** `/award-levels` - listAllAwardLevels  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：查询奖项等级列表（字典数据，按orderId排序）

- **DELETE** `/award-levels/{id}` - deleteAwardLevel  
  权限：`@SiaeAuthorize("hasAuthority('user:award-level:delete')")`  
  描述：根据ID删除奖项等级

---

## AwardTypeController - 奖项类型字典管理

**Base Path**: `/api/v1/users/award-types`

- **POST** `/award-types` - createAwardType  
  权限：`@SiaeAuthorize("hasAuthority('user:award-type:create')")`  
  描述：创建奖项类型

- **PUT** `/award-types/{id}` - updateAwardType  
  权限：`@SiaeAuthorize("hasAuthority('user:award-type:update')")`  
  描述：更新奖项类型信息

- **GET** `/award-types/{id}` - getAwardTypeById  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：根据ID获取奖项类型

- **GET** `/award-types` - listAllAwardTypes  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：查询奖项类型列表（字典数据，按orderId排序）

- **DELETE** `/award-types/{id}` - deleteAwardType  
  权限：`@SiaeAuthorize("hasAuthority('user:award-type:delete')")`  
  描述：根据ID删除奖项类型

---

## DepartmentController - 部门字典管理

**Base Path**: `/api/v1/users/departments`

- **POST** `/departments` - createDepartment  
  权限：`@SiaeAuthorize("hasAuthority('user:department:create')")`  
  描述：创建部门

- **PUT** `/departments/{id}` - updateDepartment  
  权限：`@SiaeAuthorize("hasAuthority('user:department:update')")`  
  描述：更新部门信息

- **GET** `/departments/{id}` - getDepartmentById  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：根据ID查询部门信息

- **GET** `/departments` - listAllDepartments  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：查询部门列表（字典数据，按orderId排序）

- **DELETE** `/departments/{id}` - deleteDepartment  
  权限：`@SiaeAuthorize("hasAuthority('user:department:delete')")`  
  描述：根据ID删除部门

---

## MajorController - 专业字典管理

**Base Path**: `/api/v1/users/majors`

- **POST** `/majors` - createMajor  
  权限：`@SiaeAuthorize("hasAuthority('user:major:create')")`  
  描述：创建专业

- **PUT** `/majors/{id}` - updateMajor  
  权限：`@SiaeAuthorize("hasAuthority('user:major:update')")`  
  描述：更新专业信息

- **GET** `/majors/{id}` - getMajorById  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：根据ID查询专业信息

- **GET** `/majors` - listAllMajors  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：查询专业列表（字典数据）

- **DELETE** `/majors/{id}` - deleteMajor  
  权限：`@SiaeAuthorize("hasAuthority('user:major:delete')")`  
  描述：根据ID删除专业

---

## MembershipController - 成员管理

**Base Path**: `/api/v1/users/memberships`

- **POST** `/memberships/apply` - applyForMembership  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL)`  
  描述：申请成为候选成员

- **PUT** `/memberships/{id}/promote` - promoteToOfficial  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL)`  
  描述：候选成员转正

- **PUT** `/memberships/{id}` - updateMembership  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL)`  
  描述：更新成员信息

- **DELETE** `/memberships/{id}` - deleteMembership  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL)`  
  描述：逻辑删除成员记录

- **GET** `/memberships/{id}` - getMembershipById  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL)`  
  描述：根据成员ID查询成员基本信息

- **GET** `/memberships/by-user/{userId}` - getMembershipByUserId  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL)`  
  描述：根据用户ID查询成员信息

- **GET** `/memberships/{id}/detail` - getMembershipDetail  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL)`  
  描述：查询成员详情（含用户、部门、职位）

- **POST** `/memberships/page` - pageMemberships  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL)`  
  描述：分页查询成员（支持分页、筛选、关键字搜索）

- **GET** `/memberships/check/{userId}` - isMember  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL)`  
  描述：检查用户成员身份（判断用户是否为成员）

- **GET** `/memberships/check/{userId}/candidate` - isCandidate  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL)`  
  描述：检查是否为候选成员

- **GET** `/memberships/check/{userId}/official` - isOfficialMember  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL)`  
  描述：检查是否为正式成员

---

## PositionController - 职位字典管理

**Base Path**: `/api/v1/users/positions`

- **POST** `/positions` - createPosition  
  权限：`@SiaeAuthorize("hasAuthority('user:position:create')")`  
  描述：创建职位

- **PUT** `/positions/{id}` - updatePosition  
  权限：`@SiaeAuthorize("hasAuthority('user:position:update')")`  
  描述：更新职位信息

- **GET** `/positions/{id}` - getPositionById  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：根据ID查询职位信息

- **GET** `/positions` - listAllPositions  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：查询职位列表（字典数据，按orderId排序）

- **DELETE** `/positions/{id}` - deletePosition  
  权限：`@SiaeAuthorize("hasAuthority('user:position:delete')")`  
  描述：根据ID删除职位

---

## StatisticsController - 统计管理

**Base Path**: `/api/v1/users/statistics`

- **GET** `/statistics/overview` - getMemberOverview  
  权限：**无权限注解（需要添加）**  
  描述：获取成员概览统计

- **GET** `/statistics/departments` - getDepartmentStats  
  权限：**无权限注解（需要添加）**  
  描述：获取部门分布统计

- **GET** `/statistics/awards/overview` - getAwardOverview  
  权限：**无权限注解（需要添加）**  
  描述：获取获奖概览统计

- **GET** `/statistics/awards/by-level` - getAwardsByLevel  
  权限：**无权限注解（需要添加）**  
  描述：获取按奖项等级分布

- **GET** `/statistics/awards/by-type` - getAwardsByType  
  权限：**无权限注解（需要添加）**  
  描述：获取按奖项类型分布

- **GET** `/statistics/awards/trend` - getAwardTrend  
  权限：**无权限注解（需要添加）**  
  描述：获取获奖趋势（含等级分布）

- **GET** `/statistics/awards/top` - getAwardRanking  
  权限：**无权限注解（需要添加）**  
  描述：获取获奖排行榜

- **GET** `/statistics/demographics/gender` - getGenderStats  
  权限：**无权限注解（需要添加）**  
  描述：获取性别分布

- **GET** `/statistics/demographics/grade` - getGradeStats  
  权限：**无权限注解（需要添加）**  
  描述：获取年级分布

- **GET** `/statistics/demographics/major` - getMajorStats  
  权限：**无权限注解（需要添加）**  
  描述：获取专业分布

- **GET** `/statistics/positions` - getPositionStats  
  权限：**无权限注解（需要添加）**  
  描述：获取职位分布

- **GET** `/statistics/membership/trend` - getMembershipTrend  
  权限：**无权限注解（需要添加）**  
  描述：获取入会趋势

---

## UserAwardController - 用户获奖记录管理

**Base Path**: `/api/v1/users/awards`

- **POST** `/awards` - createUserAward  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL + " and hasAuthority('user:award:create')")`  
  描述：创建用户获奖记录

- **PUT** `/awards/{id}` - updateUserAward  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL + " and hasAuthority('user:award:update')")`  
  描述：更新用户获奖记录信息

- **GET** `/awards/{id}` - getUserAwardById  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL + " and hasAuthority('user:award:view')")`  
  描述：根据ID获取用户获奖记录

- **POST** `/awards/user/{userId}/page` - pageUserAwardsByUserId  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL + " and hasAuthority('user:award:list')")`  
  描述：根据用户ID分页获取用户获奖记录列表

- **POST** `/awards/page` - listUserAwardsByPage  
  权限：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL + " and hasAuthority('user:award:list')")`  
  描述：分页查询用户获奖记录

- **DELETE** `/awards/{id}` - deleteUserAward  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL + " and hasAuthority('user:award:delete')")`  
  描述：根据ID删除用户获奖记录

---

## UserController - 用户管理

**Base Path**: `/api/v1/users`

- **POST** `/` - createUser  
  权限：`@SiaeAuthorize("hasAuthority('user:create')")`  
  描述：创建用户

- **PUT** `/{id}` - updateUser  
  权限：`@SiaeAuthorize(RoleConstants.ADMIN_LEVEL + " and hasAuthority('user:update')")`  
  描述：更新用户信息

- **GET** `/` - getUser  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：查询用户详细信息（支持按ID、用户名、学号查询）

- **POST** `/page` - listUsersByPage  
  权限：`@SiaeAuthorize(RoleConstants.ANY_AUTHENTICATED)`  
  描述：分页查询用户列表

- **DELETE** `/{id}` - deleteUser  
  权限：`@SiaeAuthorize("hasAuthority('user:delete')")`  
  描述：根据ID删除用户

- **GET** `/check-student-id/{studentId}` - checkStudentIdExists  
  权限：**无权限注解（公开接口）**  
  描述：检查学号是否存在

---

## UserFeignController - 用户Feign接口（服务间调用）

**Base Path**: `/api/v1/users/feign`

- **POST** `/feign/register` - registerUser  
  权限：**无权限注解（内部调用）**  
  描述：用户注册（基础信息）

- **GET** `/feign/username/{username}` - getUserByUsername  
  权限：**无权限注解（内部调用）**  
  描述：根据用户名查询用户认证信息（包含密码）

- **GET** `/feign/exists/username/{username}` - checkUsernameExists  
  权限：**无权限注解（内部调用）**  
  描述：检查用户名是否存在

- **GET** `/feign/exists/student-id/{studentId}` - checkStudentIdExists  
  权限：**无权限注解（内部调用）**  
  描述：检查学号是否存在

- **GET** `/feign/exists/user-id/{userId}` - checkUserIdExists  
  权限：**无权限注解（内部调用）**  
  描述：检查用户ID是否存在

- **GET** `/feign/batch` - batchGetUserProfiles  
  权限：**无权限注解（内部调用）**  
  描述：批量查询用户信息

---

## 权限常量说明

### 角色级别常量
- `RoleConstants.ANY_AUTHENTICATED` - 所有已认证用户
- `RoleConstants.MEMBER_LEVEL` - 成员级别（管理员或成员）
- `RoleConstants.ADMIN_LEVEL` - 管理员级别
- `RoleConstants.ROOT_LEVEL` - 超级管理员（默认放行所有接口）

### 权限码列表
```java
// 用户管理
user:create                 // 创建用户
user:update                 // 更新用户
user:delete                 // 删除用户

// 获奖记录
user:award:create           // 创建获奖记录
user:award:update           // 更新获奖记录
user:award:view             // 查看获奖记录
user:award:list             // 列表获奖记录
user:award:delete           // 删除获奖记录

// 字典管理
user:award-level:create     // 创建奖项等级
user:award-level:update     // 更新奖项等级
user:award-level:delete     // 删除奖项等级

user:award-type:create      // 创建奖项类型
user:award-type:update      // 更新奖项类型
user:award-type:delete      // 删除奖项类型

user:department:create      // 创建部门
user:department:update      // 更新部门
user:department:delete      // 删除部门

user:major:create           // 创建专业
user:major:update           // 更新专业
user:major:delete           // 删除专业

user:position:create        // 创建职位
user:position:update        // 更新职位
user:position:delete        // 删除职位
```

---

## 需要修改的接口

### 1. StatisticsController - 所有接口缺少权限注解
**建议权限配置：**
- 所有统计接口建议使用：`@SiaeAuthorize(RoleConstants.MEMBER_LEVEL)`
- 理由：统计数据属于内部信息，应该只对成员及以上级别开放

### 2. UserController.checkStudentIdExists - 公开接口
**当前状态：** 无权限注解  
**建议：** 保持公开（用于注册时验证学号）

### 3. UserFeignController - 所有接口
**当前状态：** 无权限注解  
**建议：** 保持无权限注解（内部服务调用，通过网关或其他方式控制访问）

---

## 修改建议优先级

### 高优先级（必须修改）
1. **StatisticsController** - 12个接口都缺少权限控制，存在安全风险

### 中优先级（建议优化）
无

### 低优先级（可选）
无

---

## 使用说明

1. **确认对照表**：请仔细检查每个接口的权限配置是否合理
2. **提出修改**：如需调整权限，请直接在此文档中修改
3. **应用配置**：确认无误后，AI将根据此对照表批量更新Controller文件

---

**等待用户确认...**
