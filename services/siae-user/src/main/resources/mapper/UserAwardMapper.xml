<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hngy.siae.user.mapper.UserAwardMapper">

    <!-- 基础字段 -->
    <sql id="BaseColumns">
        id,
        award_title AS awardTitle,
        award_level_id AS awardLevelId,
        award_type_id AS awardTypeId,
        awarded_by AS awardedBy,
        awarded_at AS awardedAt,
        description,
        certificate_file_id AS certificateFileId,
        team_members AS teamMembers,
        is_deleted AS isDeleted,
        created_at AS createdAt,
        updated_at AS updatedAt
    </sql>

    <!-- 分页查询用户获奖记录 -->
    <select id="selectUserAwardPage" resultType="com.hngy.siae.user.entity.UserAward">
        SELECT
            <include refid="BaseColumns"/>
        FROM user_award
        WHERE is_deleted = 0
        <if test="query != null">
            <if test="query.id != null">
                AND id = #{query.id}
            </if>
            <if test="query.userId != null">
                AND JSON_CONTAINS(team_members, #{query.userId})
            </if>
            <if test="query.awardTypeId != null">
                AND award_type_id = #{query.awardTypeId}
            </if>
            <if test="query.awardLevelId != null">
                AND award_level_id = #{query.awardLevelId}
            </if>
            <if test="query.awardTitle != null and query.awardTitle != ''">
                AND award_title LIKE CONCAT('%', #{query.awardTitle}, '%')
            </if>
            <if test="query.awardedBy != null and query.awardedBy != ''">
                AND awarded_by LIKE CONCAT('%', #{query.awardedBy}, '%')
            </if>
            <if test="query.awardDateStart != null">
                AND awarded_at &gt;= #{query.awardDateStart}
            </if>
            <if test="query.awardDateEnd != null">
                AND awarded_at &lt;= #{query.awardDateEnd}
            </if>
        </if>
        ORDER BY awarded_at DESC
    </select>


</mapper>
