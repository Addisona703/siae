<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hngy.siae.user.mapper.AwardTypeMapper">

    <!-- 查询所有奖项类型及其关联的奖项数量 -->
    <select id="selectAllWithRefCount" resultType="com.hngy.siae.user.dto.response.AwardTypeVO">
        SELECT
            at.id,
            at.name,
            at.order_id AS orderId,
            COALESCE(COUNT(ua.id), 0) AS refCount
        FROM award_type at
        LEFT JOIN user_award ua ON at.id = ua.award_type_id AND ua.is_deleted = 0
        GROUP BY at.id, at.name, at.order_id
        ORDER BY at.order_id ASC, at.id ASC
    </select>

</mapper>
