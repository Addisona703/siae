<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hngy.siae.user.mapper.ClassUserMapper">

    <!-- 分页查询班级用户关联信息（包含用户基本信息） -->
    <select id="selectClassUsersWithUserInfo" resultType="com.hngy.siae.user.dto.response.ClassUserVO">
        SELECT 
            cu.id,
            cu.class_id AS classId,
            c.year,
            c.class_no AS classNo,
            CONCAT(col.name, '-', m.name, '-', c.year, '级', c.class_no, '班') AS className,
            cu.user_id AS userId,
            u.username,
            up.real_name AS realName,
            up.nickname,
            cu.member_type AS memberType,
            cu.status,
            cu.created_at AS createdAt,
            cu.updated_at AS updatedAt
        FROM class_user cu
        LEFT JOIN class c ON cu.class_id = c.id
        LEFT JOIN college col ON c.college_id = col.id
        LEFT JOIN major m ON c.major_id = m.id
        LEFT JOIN user u ON cu.user_id = u.id
        LEFT JOIN user_profile up ON u.id = up.user_id
        ${ew.customSqlSegment}
    </select>

</mapper>
